pipeline {
  agent any
   stages { 
	stage('git checkout'){
	   steps {
	    script {
      try {
          git branch: 'censusCode', url: 'https://github.com/riddhiimakwana/CensusAnalysis.git'
      } catch(err) {
         sh "echo error in checkout"
      }
	  }
   }
   }
	stage('Verify S3 setup') {
	   steps { 
	    script {
       try {
      // you need aws credentials
      withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'Rp_AWS_Credential', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY', correctClockSkew: true]])  {
         sh "/usr/local/bin/aws s3 ls"
         }
      } catch(err) {
         sh "echo error in sending artifacts to s3"
      }
   }
}   
  }   
   stage('PushingCode  to s3') {
      steps { 
	    script {
       try {
      // you need aws credentials
      withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'Rp_AWS_Credential', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY', correctClockSkew: true]])  {
         sh "/usr/local/bin/aws s3 ls"
         sh "/usr/local/bin/aws s3 cp /var/lib/jenkins/workspace/masterSeniorProject/masterfile.py     s3://projectsp1/"
         sh "/usr/local/bin/aws s3 cp /var/lib/jenkins/workspace/masterSeniorProject/All_data.csv   s3://projectsp1/"
	 sh "/usr/local/bin/aws s3 cp /var/lib/jenkins/workspace/masterSeniorProject/multipleRegressionLines10.py	s3://projectsp1/"
	  sh "/usr/local/bin/aws s3 cp /var/lib/jenkins/workspace/masterSeniorProject/multipleRegressionLines00_01.py	s3://projectsp1/"
         }
      } catch(err) {
         sh "echo error in sending artifacts to s3"
	 sh "exit 1"
      }
   }
   }
   }
 }
}
